"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[65696],{81635:(e,o,i)=>{i.r(o),i.d(o,{DeviceCodePage:()=>$,default:()=>z});i(4173),i(77950),i(31235),i(85940),i(94908),i(6886),i(60523);var s=i(52322),r=i(96473),t=i(79517),n=i(46209),c=i(53249),d=i(16216),a=i(87342),l=i(27256),v=i(2784),_=i(74495),u=i(4517);const g=i.p+"static/media/xbox-com-tvsetup-qr.5513d643.png";var C="DeviceCodePage-module__contentText___igWwS",p="DeviceCodePage-module__textRow___uxx4K";i(71372),i(73439);const m=()=>"undefined"!==typeof globalThis.deviceCode;class h{constructor(){if(!m())throw new Error("Global provider missing")}getDeviceCode(e){let{cv:o,msaCorrelationId:i}=e;return new Promise(((e,s)=>{globalThis.deviceCode.getDeviceCode(o,i,e,(e=>s(new Error(e))))}))}async checkForToken(e){let{deviceCode:o,cv:i,msaCorrelationId:s}=e;return new Promise(((e,r)=>{globalThis.deviceCode.checkForToken(o,i,s,e,(e=>r(new Error(e))))}))}}i(36728),i(6710),i(88233),i(48166),i(26464),i(45162);var D=i(3062),P=i(89085),w=i(34046);const f=JSON.stringify({error:D.gT.AUTHORIZATION_PENDING});class x{constructor(e){if(this.telemetryProvider=e,this.nextRequestId=0,!(0,w.r)())throw new Error("TizenDeviceCodeProvider requires Tizen api");this.serviceId=`${tizen.application.getCurrentApplication().appInfo.packageId}.Service`,this.responseMessagePort=tizen.messageport.requestLocalMessagePort("deviceCodeFlow-response")}async getDeviceCode(e){let{cv:o,msaCorrelationId:i}=e;return this.sendDeviceCodeFlowRequest("getDeviceCode",void 0,o,i)}async checkForToken(e){let{deviceCode:o,cv:i,msaCorrelationId:s}=e;return this.sendDeviceCodeFlowRequest("checkForToken",o,i,s)}sendDeviceCodeFlowRequest(e,o,i,s){return new Promise(((r,t)=>{const n=(++this.nextRequestId).toString(),c=this.telemetryProvider.logger(),{ApplicationControl:d,ApplicationControlData:a}=tizen;c.info(`sendDeviceCodeFlowRequest: ${e}, requestId: ${n}`);const l=this.responseMessagePort.addMessagePortListener((o=>{var i,s,d;try{c.info(`${e} response: ${JSON.stringify(o)}`);const t=null===(i=o.find((o=>o.key===`deviceCodeFlow-${e}-response`)))||void 0===i?void 0:i.value,a=null===(s=o.find((e=>"responseId"===e.key)))||void 0===s?void 0:s.value;if(l&&a===n&&(c.info(`Removing listener from port: ${l} (requestId: ${n})`),this.responseMessagePort.removeMessagePortListener(l)),!t){const i=null===(d=o.find((o=>o.key===`deviceCodeFlow-${e}-error`)))||void 0===d?void 0:d.value;throw new Error(null!==i&&void 0!==i?i:"Unexpected error")}a===n?r("pending"===t?f:t):c.info(`ignoring response; (requestId(${n}) != responseId(${a}))`)}catch(a){const e=(0,P.L)(a);t(e)}}));c.info(`Response message port: ${l}`);const v=[new a("deviceCodeFlowRequestKey",[e]),new a("requestId",[n.toString()])];i&&v.push(new a("ms-cv",[i])),s&&v.push(new a("msaCorrelationId",[s])),o&&v.push(new a("deviceCodeFlowRequestValue",[o]));const _=new d("deviceCodeFlowRequest",null,null,null,v);tizen.application.launchAppControl(_,this.serviceId,(()=>{c.info("background service launched")}),(e=>{c.info(`background service launch error: ${e.toString()}`)}))}))}}var k=i(3522),T=i(8318),I=i(23395),N=i(87223),S=i(95577),L=i(62598),b=i(98660),j=i(86523),E=i(5653),q=i(5801),y=i(77062);const $=e=>{let{deviceCode:o}=e;var i;(0,L.A)(),(0,b.tR)();const D=(0,a.Qc)(),f=(0,I.P)(),{search:$}=(0,u.TH)(),z=(0,n.useLogger)("DeviceCodePage"),A=(0,v.useMemo)((()=>m()?new h:(0,w.r)()?new x(D):new l.a7(D)),[D]),{deviceCodeError:F,deviceCodeResponse:R,deviceCodeState:O,fetchDeviceCode:U}=(0,l.NW)(A),[,,{setUserSetting:M}]=(0,N.B)("hasSkippedOnboarding"),{origin:B}=(0,_.useSelector)(d.Xnf),{locale:K}=(0,_.useSelector)(d.yWe),[H,G]=(0,v.useState)(void 0);(0,v.useEffect)((()=>{if(!o)if(O===l.lP.None)U();else if(O===l.lP.Complete){const e=new URLSearchParams($).get(k.R4.redirectUrl),o=`${B}/${K}${E.InitializeSinglePageApplication.getLink(null!==e&&void 0!==e?e:f)}`;M(!0),window.location.replace(o)}}),[o,O,U,K,f,B,$,M]),(0,v.useEffect)((()=>{var e;if(F){try{null===(e=globalThis.window)||void 0===e||e.sessionStorage.setItem(T.TC,"true")}catch(o){const e=(0,P.L)(o);z.warn("Failed to access storage",e.message)}let i="ErrorPage_Description_DeviceCodeOther",s=!0;(null===F||void 0===F?void 0:F.message.includes("expired_token"))&&(i="ErrorPage_Description_DeviceCodeExpired",s=!1),G({errorLocalizedMessage:"ErrorPage_Title_DeviceCode",errorLocalizedDescription:i,isUserError:s})}}),[F,z]);const{isTizen:W}=(0,S.d)(),[J,Q,Z,V,X,Y,ee]=(0,j.QF)("DeviceCodePage_Title","DeviceCodePage_Step1","DeviceCodePage_Step1Link","DeviceCodePage_Step2","DeviceCodePage_Footer_Tizen","Back","Accessibility_Button_B_Go_Back"),oe=null!==(i=null===R||void 0===R?void 0:R.user_code)&&void 0!==i?i:o,ie=o||R&&O===l.lP.AuthorizationPending,se=`${Z}.`,re=`${null===oe||void 0===oe?void 0:oe.split("").join(". ")}.`;return(0,s.jsx)(q.Pl,{location:"DeviceCodePage",children:H?(0,s.jsx)(y.J,{localizedTitleKey:H.errorLocalizedMessage,localizedDescriptionKey:H.errorLocalizedDescription,isUserError:H.isUserError}):ie?(0,s.jsxs)("section",{className:"DeviceCodePage-module__page___Us+SL","aria-live":"assertive","aria-atomic":"true",children:[(0,s.jsx)("h1",{className:"DeviceCodePage-module__title___fgsO1",children:J}),(0,s.jsxs)("div",{className:"DeviceCodePage-module__content___SqKl0",children:[(0,s.jsxs)("ol",{className:"DeviceCodePage-module__instructionList___ZVWA0",children:[(0,s.jsx)("li",{className:p,children:(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:C,children:Q}),(0,s.jsx)("div",{className:"DeviceCodePage-module__linkText___koBh5","aria-label":se,children:Z})]})}),(0,s.jsx)("li",{className:p,children:(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:C,children:V}),(0,s.jsx)("div",{className:"DeviceCodePage-module__codeText___gwbbI","aria-label":re,"data-testid":"codeText",children:oe})]})}),W&&(0,s.jsx)("div",{className:"DeviceCodePage-module__footerText___7GHLf",children:X})]}),(0,s.jsx)("div",{className:"DeviceCodePage-module__pictureSection___cpYBp",children:(0,s.jsx)("img",{src:g,alt:se})})]}),(0,s.jsx)(r.j0,{className:"DeviceCodePage-module__back___nEPdz",icon:t.Z,iconClassName:"DeviceCodePage-module__backIcon___5qmMQ",label:Y,labelClassName:"DeviceCodePage-module__backLabel___kc7OC","aria-label":ee})]}):(0,s.jsx)(c.h2,{})})},z=$}}]);
//# sourceMappingURL=device-code-page.730896e6.chunk.js.map
